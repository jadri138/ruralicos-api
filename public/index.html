<!DOCTYPE HTML>
<html>
	<head>
		<title>Ruralicos ‚Äì Alertas del BOE para el campo</title>
		<link rel="icon" type="image/png" href="assets/images/favicon.png">
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<meta name="description" content="Ruralicos convierte el BOE y los boletines oficiales en alertas simples y claras para agricultores y ganaderos, directo a tu WhatsApp." />
		<meta name="keywords" content="Ruralicos, BOE, ayudas, agricultura, ganader√≠a, boletines oficiales, mundo rural, WhatsApp" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<style>
			/* Checkbox nativo visible para la selecci√≥n */
			input[type="checkbox"] {
			  -webkit-appearance: checkbox !important;
			  -moz-appearance: checkbox !important;
			  appearance: checkbox !important;
			  opacity: 1 !important;
			  position: static !important;
			  margin-right: 0.5rem !important;
			}
			/* Estilos de landing optimizados */
			#intro .content .image { width: 10em; height: 10em; margin-bottom: 0; }
			#intro .content h2 { margin-top: 0.5em; }
			#form-registro .fields {
				display: grid;
				grid-template-columns: repeat(2, 1fr);
				gap: 1.5rem;
			}
			@media screen and (max-width: 980px) {
				#form-registro .fields { grid-template-columns: 1fr; }
			}
			/* Contenedores de preferencias */
			.preferences-container { border: 1px solid rgba(255, 255, 255, 0.2); padding: 1.5rem; border-radius: 4px; margin-bottom: 2rem; }
			.preferences-container h3 { margin-top: 0; margin-bottom: 1rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1); padding-bottom: 0.5rem; }
			.preferences-group { display: flex; flex-wrap: wrap; gap: 1rem; margin-bottom: 1rem; }
			.preference-item { margin-right: 1.5rem; white-space: nowrap; }
		</style>
	</head>
	<body class="is-preload">

		<div id="wrapper">

			<section id="intro" class="wrapper style1 fullscreen fade-up">
				<div class="inner">
					<div class="content">
						<span class="image"><img src="assets/images/logo_ruralicos.png" alt="Logo de Ruralicos: Alertas BOE para el campo" /></span>
						<h2>Ruralicos üöú</h2>
						<p>Convierte el **BOE** y los boletines oficiales en **alertas simples y claras** para **agricultores y ganaderos**, directo a tu WhatsApp.</p>
						<ul class="actions">
							<li><a href="#one" class="button scrolly">¬°Quiero probar la Beta!</a></li>
						</ul>
					</div>
				</div>
			</section>

			<section id="one" class="wrapper style2 spotlights">
				<section>
					<a href="#" class="image"><img src="assets/images/pic01.jpg" alt="" data-position="center center" /></a>
					<div class="content">
						<div class="inner">
							<h2>Adi√≥s a leer 50 p√°ginas de BOE üìö</h2>
							<p>Nuestro sistema de **Inteligencia Artificial** escanea diariamente los boletines oficiales y solo te env√≠a lo que **realmente te afecta**: ayudas, subvenciones, convocatorias, y novedades legislativas. Olv√≠date de buscar, nosotros te avisamos.</p>
						</div>
					</div>
				</section>
				<section>
					<a href="#" class="image"><img src="assets/images/pic02.jpg" alt="" data-position="top center" /></a>
					<div class="content">
						<div class="inner">
							<h2>Alertas Personalizadas üåæ</h2>
							<p>Elige tu **sector** (agricultura, ganader√≠a, pesca...), tus **subsectores** (c√≠tricos, vacuno de leche, etc.) y tus **provincias** de inter√©s. De esta manera, garantizamos que solo recibas notificaciones relevantes para tu actividad. </p>
						</div>
					</div>
				</section>
				<section>
					<a href="#" class="image"><img src="assets/images/pic03.jpg" alt="" data-position="25% 25%" /></a>
					<div class="content">
						<div class="inner">
							<h2>Directo a tu WhatsApp üì≤</h2>
							<p>Recibe un resumen conciso y en lenguaje sencillo de las novedades cada ma√±ana, directamente en tu m√≥vil. **R√°pido**, **f√°cil** y **sin papeleos** (por ahora). La informaci√≥n que necesitas, justo a tiempo.</p>
						</div>
					</div>
				</section>
			</section>

			<section id="two" class="wrapper style3 fade-up">
				<div class="inner">
					<h2>Registro a la Beta Gratuita</h2>
					<p>Rellena el formulario para ser de los primeros en recibir las alertas en tu WhatsApp. Indica tus preferencias para recibir la informaci√≥n m√°s ajustada a tu perfil.</p>
					<div class="split style1">
						<section>
							<form method="post" id="registro-form">
								<div class="fields">
									<div class="field half">
										<label for="name">Nombre y Apellidos</label>
										<input type="text" name="name" id="name" required />
									</div>
									<div class="field half">
										<label for="whatsapp">WhatsApp (solo d√≠gitos)</label>
										<input type="tel" name="whatsapp" id="whatsapp" placeholder="Ej: 612345678" required />
									</div>
									<div class="field half">
										<label for="email">Email</label>
										<input type="email" name="email" id="email" required />
									</div>
									<div class="field half">
										<label for="perfil">Soy...</label>
										<div style="display: flex; gap: 1rem; align-items: center; padding-top: 0.5rem;">
											<input type="radio" id="agricultor" name="perfil" value="agricultor">
											<label for="agricultor">Agricultor/Ganadero</label>
											<input type="radio" id="tecnico" name="perfil" value="tecnico">
											<label for="tecnico">T√©cnico/Consultor</label>
										</div>
									</div>
								</div>

								<div class="preferences-container">
									<h3>Mis Preferencias (¬øQu√© me interesa?)</h3>
									<div class="field">
										<label>Sectores Principales</label>
										<div class="preferences-group">
											<div class="preference-item"><input type="checkbox" id="agr-general" name="sector" value="Agricultura General"><label for="agr-general">Agricultura General</label></div>
											<div class="preference-item"><input type="checkbox" id="gan-general" name="sector" value="Ganader√≠a General"><label for="gan-general">Ganader√≠a General</label></div>
											<div class="preference-item"><input type="checkbox" id="pesca" name="sector" value="Pesca y Acuicultura"><label for="pesca">Pesca y Acuicultura</label></div>
											<div class="preference-item"><input type="checkbox" id="medio-ambiente" name="sector" value="Medio Ambiente/Forestal"><label for="medio-ambiente">Medio Ambiente/Forestal</label></div>
										</div>
									</div>

									<div class="field">
										<label>Subsectores Espec√≠ficos (Opcional)</label>
										<div class="preferences-group">
											<div class="preference-item"><input type="checkbox" id="vacuno-leche" name="subsector" value="Vacuno de Leche"><label for="vacuno-leche">Vacuno de Leche</label></div>
											<div class="preference-item"><input type="checkbox" id="citricos" name="subsector" value="C√≠tricos"><label for="citricos">C√≠tricos</label></div>
											<div class="preference-item"><input type="checkbox" id="olivar" name="subsector" value="Olivar"><label for="olivar">Olivar</label></div>
											<div class="preference-item"><input type="checkbox" id="cereal" name="subsector" value="Cereal"><label for="cereal">Cereal</label></div>
											<div class="preference-item"><input type="checkbox" id="vino" name="subsector" value="Vino/Viticultura"><label for="vino">Vino/Viticultura</label></div>
										</div>
									</div>

									<div class="field">
										<label>Provincias de Inter√©s (M√°ximo 3)</label>
										<div class="preferences-group">
											<div class="preference-item"><input type="checkbox" id="sevilla" name="provincia" value="Sevilla"><label for="sevilla">Sevilla</label></div>
											<div class="preference-item"><input type="checkbox" id="madrid" name="provincia" value="Madrid"><label for="madrid">Madrid</label></div>
											<div class="preference-item"><input type="checkbox" id="valencia" name="provincia" value="Valencia"><label for="valencia">Valencia</label></div>
											<div class="preference-item"><input type="checkbox" id="leon" name="provincia" value="Le√≥n"><label for="leon">Le√≥n</label></div>
										</div>
									</div>

									<div class="field">
										<label>Tipos de Alerta</label>
										<div class="preferences-group">
											<div class="preference-item"><input type="checkbox" id="ayudas" name="tipo_alerta" value="Ayudas y Subvenciones"><label for="ayudas">Ayudas y Subvenciones</label></div>
											<div class="preference-item"><input type="checkbox" id="convocatorias" name="tipo_alerta" value="Convocatorias y Plazos"><label for="convocatorias">Convocatorias y Plazos</label></div>
											<div class="preference-item"><input type="checkbox" id="legislacion" name="tipo_alerta" value="Legislaci√≥n"><label for="legislacion">Legislaci√≥n</label></div>
										</div>
									</div>
								</div>

								<div class="field">
									<label for="message">Comentario (Opcional, para que nos cuentes qu√© necesitas)</label>
									<textarea name="message" id="message" rows="4"></textarea>
								</div>
								<ul class="actions">
									<li><input type="submit" value="¬°Quiero recibir las alertas!" class="button primary" /></li>
								</ul>
							</form>
						</section>
						<section>
							<h3>Informaci√≥n de Contacto</h3>
							<ul class="contact">
								<li><h3>Email</h3><a href="mailto:info@ruralicos.es">info@ruralicos.es</a></li>
								<li><h3>Ubicaci√≥n</h3><span>Espa√±a</span></li>
								<li><h3>Redes Sociales</h3>
									<ul class="icons">
										<li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
										<li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
										<li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
									</ul>
								</li>
							</ul>
						</section>
					</div>
				</div>
			</section>

			<footer id="footer" class="wrapper style1-alt">
				<div class="inner">
					<ul class="menu">
						<li>&copy; Ruralicos. Todos los derechos reservados.</li><li>Dise√±o: <a href="http://html5up.net">HTML5 UP</a></li>
					</ul>
				</div>
			</footer>

		</div>

		<script src="assets/js/jquery.min.js"></script>
		<script src="assets/js/jquery.scrolly.min.js"></script>
		<script src="assets/js/jquery.scrollex.min.js"></script>
		<script src="assets/js/browser.min.js"></script>
		<script src="assets/js/breakpoints.min.js"></script>
		<script src="assets/js/util.js"></script>
		<script src="assets/js/main.js"></script>

		<script>
			// Constantes para validar que los datos enviados existen en el sistema
			const SECTORES = ["Agricultura General", "Ganader√≠a General", "Pesca y Acuicultura", "Medio Ambiente/Forestal"];
			const SUBSECTORES = ["Vacuno de Leche", "C√≠tricos", "Olivar", "Cereal", "Vino/Viticultura"];
			const PROVINCIAS = ["Sevilla", "Madrid", "Valencia", "Le√≥n"]; // Agregar el resto de provincias
			const TIPOS_ALERTA = ["Ayudas y Subvenciones", "Convocatorias y Plazos", "Legislaci√≥n"];

			const handleSubmit = async (event) => {
				event.preventDefault();

				const form = document.getElementById("registro-form");
				const submitButton = form.querySelector('input[type="submit"]');

				const name = form.querySelector('input[name="name"]').value.trim();
				let whatsapp = form.querySelector('input[name="whatsapp"]').value;
				const email = form.querySelector('input[name="email"]').value.trim();
				const message = form.querySelector('textarea[name="message"]').value.trim();
				const perfil = form.querySelector('input[name="perfil"]:checked')?.value || null;

				// 1. Validaciones b√°sicas
				if (!name || !whatsapp || !email) {
					alert("Por favor, rellena todos los campos obligatorios: Nombre, Tel√©fono y Email.");
					return;
				}

				// 2. Normalizaci√≥n y validaci√≥n del tel√©fono
				whatsapp = whatsapp.replace(/[^0-9]/g, "");
				if (whatsapp.length < 9) {
					alert("El n√∫mero de WhatsApp no parece v√°lido. Debe tener al menos 9 d√≠gitos (ej. 6XXXXXXXX).");
					return;
				}

				// 3. Recolecci√≥n de preferencias (funci√≥n auxiliar para simplificar)
				const getCheckedValues = (name, validArray) => {
					const values = [];
					form.querySelectorAll(`input[name="${name}"]:checked`).forEach(cb => {
						if (validArray.includes(cb.value)) values.push(cb.value);
					});
					return values;
				};

				const tipos_alerta = {};
				TIPOS_ALERTA.forEach(k => tipos_alerta[k] = false);
				form.querySelectorAll('input[name="tipo_alerta"]:checked').forEach(cb => {
					if (TIPOS_ALERTA.includes(cb.value)) tipos_alerta[cb.value] = true;
				});

				const preferences = {
					sectores: getCheckedValues('sector', SECTORES),
					provincias: getCheckedValues('provincia', PROVINCIAS),
					subsectores: getCheckedValues('subsector', SUBSECTORES),
					tipos_alerta,
					perfil,
					comentario: message
				};

				const payload = {
					name,
					email,
					phone: whatsapp,
					preferences
				};

				// 4. Desactivar bot√≥n y enviar feedback
				submitButton.disabled = true;
				submitButton.value = 'Enviando... por favor, espera.';
				
				try {
					const res = await fetch("/register", {
						method: "POST",
						headers: { "Content-Type": "application/json" },
						body: JSON.stringify(payload),
					});

					const json = await res.json();

					if (res.ok && json.success) {
						alert("¬°Listo! Te has inscrito correctamente. Te avisaremos por WhatsApp cuando empecemos con los env√≠os gratuitos.");
						form.reset();
					} else if (json.error && json.error.toLowerCase().includes("ya existe")) {
						alert("Parece que ya est√°s registrado con ese tel√©fono o email. ¬°Gracias por el inter√©s!");
					} 
					else {
						alert("Error al registrar: " + (json.error || "Error de servidor desconocido. Int√©ntalo m√°s tarde."));
					}
				} catch (e) {
					console.error("Error de red:", e);
					alert("Error de conexi√≥n. Comprueba tu conexi√≥n o int√©ntalo m√°s tarde.");
				} finally {
					// 5. Reactivar bot√≥n
					submitButton.disabled = false;
					submitButton.value = '¬°Quiero recibir las alertas!';
				}
			};

			// Asignar el event listener
			document.addEventListener('DOMContentLoaded', () => {
				document.getElementById("registro-form").addEventListener("submit", handleSubmit);
			});

		</script>

	</body>
</html>